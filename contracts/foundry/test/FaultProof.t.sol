// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.24;

import {Test, console} from "forge-std/Test.sol";
import {ModelRegistry} from "../src/ModelRegistry.sol";
import {FaultProof} from "../src/FaultProof.sol";

contract FaultProofTest is Test {
    ModelRegistry public modelRegistry;
    FaultProof public faultProof;

    function setUp() public {
        // setup contracts
        modelRegistry = new ModelRegistry();
        faultProof = new FaultProof(modelRegistry, 96000, 100);

        // register model
        modelRegistry.registerModel(
            "ipfs://QmRtugH4D27AaJZMKBqPX4oyR2f3ZMykF3bMuSLNsccpbc",
            "0x010000000000000001000000000000001c000000000000001c00000000000000",
            "0x010000000000000001000000000000001c000000000000001c00000000000000",
            bytes32(0xf0c4b404383d6a9cf9cd220237b3c5dad9e410e7fdca48ac58f66e94b5c31624),
            5
        );

        // request inference
        modelRegistry.requestInference(
            0,
            "0x14bda63f1b54ec3ff886ecbf4f6461bfc687fbbf9965da3ed8b468bd80b5ee3fdf67fbbf1984a13e481fc83e9c41763e4da335be4ae4123e46796ebe4a96563f30e427bfda4727c0ea8f743f7cd6033fab539abe3314c13fba2e3ebf298c023fea7eedbe25fc0140fd4d083f4c0950bff8aa71bce0c81abf7f55823ff45db43f3dd60d3f7332bc3df46f483e49a1043fa7d88fbf23eb1c3f314175c0fbc28fbea05fd33f7ba710bfc6bef83ec43e7ebe5bf338bf4d0384bf33ff883e47f78ebf6adb80be9df5993f1396b9bedc3d3cbdf004d2be11ba1cbf416a06bf16d51fbec5ce933f518f4d3e041e0a3ff80f9b3fad4bc1bf1c39d0bd6902753efbae59bf7c7d94bf74c535bf7092f8bfa1841ec092bb523fa1acee3e34f5b23f135aef3f76992cbff71ea13fe96c4ebf73b9a6be4dca8a3ed0eaa73fb03c69bf5c419fbe988112bfb6b6f3bff7b10d40a28b6c3f9dd6823e809e4cbeec44353fe0b53abfa6810c3fe5f990bffbe46dbe0c33aebf675e473d88c30d409f6d943fe4d6d33f603c043f0d25e8be478facbf002d643ee75519bf29d46fbfa72f19402f01b83ec246453f588fd73f84c9dd3fe22353bfa1c81cbe4e9035be9564d83c4dcec13d6e639bbf776c993dc72c6cbe0896203f8f3b813ffdb6b13fdc1f9bbf137b48bfded71340a4740dbfed17ddbe7e83773f3f588cbf5d30bcbf2aa807c0c09d5d3ff7276bbff508973f06ba8b3fe953c23f0eb14abf333e533fd30f213ee8510b3f2935543f2116a43e5a046b3f3f095ebf4c5fdebe1ce6aebe4dc1a9bff139a4bf2beb76bf6754febe20c81a405cfca2bedbc33e3ee56957bfcd6f12bfdaa45a3f4fc2513ffbb92a3dd2c08f3f6701603f4acb5abf78a4f63e59023d3fd8c7873f6ade983ed635d2bf7c6547befd38b4bd2d6d8f3f46a37cbfd2e597bfff5cbdbff32c02c057777e3f21dc9dbffcdbbcbf2777853d11371dbf49af303ec1a5c53f0f631fbd452cfe3dd02d2ebfe6e9e43d1a0dd7be5d0964bf11f900c00cee9c3fdfd25e3f79dacfbf6209b53c72dacb3f74edd53eab2a95bfe74891bf18928a3e8ec23140b551acbf3025873eb7092abf46e0013fac64d4bf013686bee916353dd2040440fd72b2bf5a3d043fe45c853f338484bfdfe770bfcf59e2beb90eb3bc13e480bdab8b76bf04552b3f34b51a4015c60a3eeadc7abf5fa25bbf5a1ad2bff683583f101289be31944d3edf8fcd3f9b81d1bfbeceb53e135a46bfd4a592bf286c023f7876903e67f1b93c7c070d3fc107643fea2bb8bec5d979bf30c90240438bad3d3c8582bffcf3b7be9377d23fd80e7ebf1ee04c3fbd9075bf00c4753e1c828ebe2332cfbf4245a63ffdbc443f08cd2fbf7e9b34bf453accbf1df7cebfb5eb2cbff96201c003124a3f5b8dd03f18bdc33f1e8defbddb7649be841578bf96fa083e4da8073e1998a9be421e52bfa75e183f4c5585bfc9cb5a3e72bc0abf99670bbe28c6133fab12b33fe6c6ffbed4e8c3be2f589ebf30a10d3fcea07ebebfa0393fe82bc9bd21fa123de09624bf01be33be3134babf5a6bd5bf6d0e4ebe7aa104c0f11ca03f0e06c63d1bfaa7bf1d5cc43ef1ad02bf137b353e5c24783f3d40883eeef7833f2b2a383fd2a2343fca8f713d7f8fe1bfb05dc2bf7e1010c0daa769bef5c2f53cf04602bfc39aaabfc7f07dbf751f2f3fa195483fec40033fe2817ebf318def3f1b27e43cdbe3fe3e970b72bf03eba93fb52fb43e99b3f33e17d773be64228b3f0fecc33ee0ed333ec992d8bef4d0d93e6da9ccbf36f9ce3e4db3833fa3bb88bf2e08533f40b6cabf123dcbbeae5a8d3ffb2393bf4d7697be9e6c32bf44283dbfc458d0bffda9bcbf86a157be96db65bf3245bdbf79b98dbf8c8a83be328a4abf41e8943f7f3a40bfc6f708bda428cebf621eb43fef923f3ee3b0b23f9f36d83fd4b106bfbde31cbf66dab4bfe6db683f59db063f6fe9cf3e8321b9bf00bf433fdb61653fc704aebd058a773e32883c3feee705c0f8fb9e3f6f109abdfcd8863ff3151abf1f594dbf3c8b4dbfcd2dcebe575f103fddb0dabf050857bcdb66b73ff5b22e3fb94b99bfafea14c057f1c13fbf34fdbf65dababee51ca73e215891be4034f6bedb437abfbbcc613e330b6a3f038b1bbe0960e4bebdb1e3bddf13633fdb3b92bfe17b35bfd4ba883fb21ffdbee9778cbf786accbf02bf893ee0b9c73e8407bebec0e571bf7b48e2bf15e17f3f21dd3ebf5007c03e7a3c5d3ea32a36bf24b871bfdbbb87bf0e415abe98aad0bff8ae473fcc39a33fcb06ae3f9e5c85bf965d1d3e4d825d3f1652d43ff8a2383e5df7533fbf8f2a3fad463fbeff03e63ff141b2be43abd6bf1d3d6e3f6b81073f8cf276bfdf5324bed892323f979a133f5e57ddbcd21b89bf430237bf3b130e3f29d10d40a8ae903fe823c13e803a09bed86a703f362778be71090dbfee0968bf329ceb3edae04fbf2a0d1c3e4a07ff3e151e1fbf213087bf83aeec3e94b60cbfe0af0fbe19110b3f227f543f609c66bcf7936d3f4f2ee4bee0bbb43fdf5c303caf1f8dbfef54b7bf0ef0f3bd9580083f5cfb143f5186f53f9aa00640382369bfd3b3ca3f10122fc0e43fd53fcc9344bfc331cd3fe50c273db3c9a63efb3a97bcfdcc433fdf9c45bfabd4abbf036291bf1760893e7b5cfc3e51969a3f31e112bf20a1213e72e6923f09a2513e9d12f4bfe06135bf1f7794bf283d13403dffeb3ec0700fbf1d49823f4b6daa3e7f58b43e4fffb9be049087bfaf79c43ea08ef6be2c1a403f7f565ebe7adf2ebfd2bfdebe30aafabd1d95a9bfb3b3853feadc9f3fe089b2bf37f0c83d82d49b3e11c549bcbc3ca93f3619933f8d67d2bfa8d3243fe3b3e23c8eaed23ecb68743fcdd335bff72eafbf48aabd3f127f613fcbbf033e485052bed3fb28bf8e15abbf3e4d31bf79aab53d476a90bf39fb8a3fc5dfc13e1cdd4abe79e34abf152aa6be98cf2a3e061c01bf13b4a43f3ccf3fbf380b06c04da3393f6c8986bf0d0f363e93990c3f5a833dbe53ccd6bd77842c3fb70c0d3f679892bfe9e090be56030d3e328f42be541ea13d91aa54be0cd907c07566c13f0a47653d398f59bf483ec13e79b7243fe52bbf3f209a9abfc53f47bf14c2cfbf9aa9b8bdd1c4503ff5198a3ee1eaa7be1919383f35de47be1ba19dbf3677d4bf21b7ed3e5bd87bbeb4124e3f869d5cbf02ada4be3e2329be6a31f9be5017cebe1bee8ebe8a05803fe9892ac0cf6bc43f7115dd3fdd813a3f52f992bff2aa913e4ebc773f061c32bedeec1c3e1f34043f5efa7bbf9f73953ee8400a404861993e64c21bbc301696bfcb314f3f06f5c73fde72fc3e184a183f8602b2bfcafbedbe1655b2be64eab03feda5b83fcd158cbfa7018bbfce30163fbc07533f25fd2cbe0016053f152e57bfff9266bf8e4c653fda2d903eaf04c3be400dc93e911932bf88b7c83e322801c07a100fbf19b216bfd2a1303ed6d658bfc5d5d63f0a3e8b3fa511c13e18eba03f443c104070e0e13ed366803f4947083da20a45bd470c123f7d7fd63fe21869bf756702bf005ff3be70e6d13e28e73cbf8c8319bfc2fd10beb354b83ed7dabdbec4d36640f18565bd103706bdc9cc4abfeb26b2bfc58903c034373e3f4c4b053fd90c923f78adbd3e3cee913fe5cdf43f42d5f53e1fdb4f3e03d963beb3dafebd27807d3d4c1604bfaab948be677f0f3ed34b153e0be604c0e722713f1c2056be121de23ce289743f7356f8bf75df453ee4e99d3f3dc90ebf175384bd0a61b0bfefb13bbb877e2abf2df255bf63f488bded980040f067b5bfc2d4413f1cff193f36f29d3e334337bf2067ce3fb3d172bf6d9684bf528a653f1eef2ebf08101c3edcc177bf76ef2abd68000ebfe4902e3f08a51fbe3260a9bffd9949be6411863fb1df69bfe5e5733f2748fa3fc4e2953e5f0b78bf26c5133f155800be859bc6be348d953f0d04ccbff65e7dbf96fd783d37f3b4be6eb5b8bee84aa53f0fcbdabd620e143fae8c73bf8fd68dbfe96d57be8cf925bfe3d2aa3f6bed69be2557043f988e4abf17f80fbe4a44d5bfbb3f0dc0623f10c02f816ebf6416a0bebed3a3bd46d0e83ffc7ac03f9500133f814205bf502ab23e5af684bf8145bdbfcde66d3eadac6a3fd751a03fda2fa5bf8b2160bea74859bf8319b43fc78c213f11d9a73e7b15363fc63b0340dcef96be9c31913f887a7b3f4dbde33ff7f22c3fa4679c3edc380d3f75fa943f391928be0d52b0bf55b49c3f102d20bf96ed7d3f7e78e6be7e85e6beb7aa94bec46d60be8f70473eda173d3edb2129bfd6655a3fcac579bf4bf3923e3c5278bf180da83efa1125402bdc89bfb4722c3da7963fbf7af6ba3e106e073f54e180bf32c6aa3e80b4b33fb46c94bfdee36a39b4b3e7be07bb08c0",
            bytes32(0x146f4c9ec0d65d800cd2f89ee8c114fd3da952823d2898d5b3ff87b3904b6d4a)
        );
    }

    // Submitter correctly computed the ONNX operators. Challenger says the output is incorrect, but the input to the last ONNX operator is correct.
    function test_FaultProofCorrect() public {
        // respond inference
        modelRegistry.respondInference(
            0,
            "0x4a1c883e4892983e79a1a9bd8d289ebefa1f7ebe6234f43deb8a433eae4c85bec73b3e3ddcf11ebe266d0ebec2e9b53ebc5df1bd61b0fabe0dc74e3e9e8158be32b86c3d3ce0d1bd515b013db4d9433df80ebcbc8bfcd53dfc6d53be8378c9bd3ff9173d1e32fa3ca81f3dbe22cc953e5faaa23d1fa682be22b126bdd3362c3d06dd983ef0ca39bee8a62d3c051e8b3e072fcfbc2e7ffabd74e9d93d6e15083d0efcb0be840b76bc09ea603cd4aa763d3cc7cd3c9c0eff3d0aa1013ecdc70a3e11b8e5bc702a73bd31f0373f027e363eeaf5803e1134e0bea739a4bdeecc633e2ba6533d34deb43d823244bf327ed63da0a0e03d507e85be61c80b3d82d4fe3d4888c7bd1c9e77bc4f3abcbcb8233bbcd4f1adbe17c11d3ea4cc31bd1630a1bcf0c2d0bd7c2592be9d2c7ebe0b4d81bc9e5521be2b3bc4bd0f50bf3dda60923eee321dbc75253cbeac76ed3d9bbed23d40063fbbd88d47be682a403ec140ad3d385d48bd60e3123e34b7f03ea869ba3d8e22e03c5bd1283ee0ecefbdd800363d7e8a003e8445903eda0afbbd0ae13d3e",
            bytes32(0x146f4c9ec0d65d800cd2f89ee8c114fd3da952823d2898d5b3ff87b3904b6d4a)
        );

        // create challenge
        faultProof.createChallenge(0);

        // TODO
    }

    // Submitter did not correctly compute the second ONNX operator.
    function test_FaultProofStep2() public {}

    // Submitter did not correctly compute the zero ONNX operator.
    function test_FaultProofStep0() public {}

    // Submitter did not correctly compute the fourth ONNX operator.
    function test_FaultProofStep4() public {}
}
